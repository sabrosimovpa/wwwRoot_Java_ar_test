<!DOCTYPE html>
<html>

<head>
    <title>AcselerationTests</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <!-- <script src="https://aframe.io/releases/0.6.1/aframe.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script> -->
</head>

<body>
    <div>
        <p>
            <div style="text-align: center;">
                <button id="Startbutton">
                    Start
                </button>
            </div>
        </p>
        <p>
            <div style="text-align: center;">
                <button id="Stopbutton">
                    Stop
                </button>
            </div>
    </div>
    </p>

    <p>
        <div id="rawData">Thereiswilbe some data</div>
    </p>

    <script>
        function simplyVector()
        {
            var vec = {X: 0.0, Y:0.0, Z:0.0}
            return vec
        }

        function simplyVector()
        {
            var vec = {X: 0.0, Y:0.0, Z:0.0}
            return vec
        }
        function simpleVectorCPY(vector)
        {
            var newVec = simplyVector()
            newVec.X = vector.X
            newVec.Y = vector.Y
            newVec.Z = vector.Z

            return newVec
        }

        var Startbutton = undefined;
        var Stopbutton = undefined;
        var rawData = undefined;
        var rawDataDiv = undefined;
        var aclData = undefined
        let acl = new LinearAccelerationSensor({ frequency: 10 });
        // let acl = new Accelerometer ();
        var startTime = undefined;

        var velocity = simplyVector();
        var privAcl = simplyVector();
        var path = simplyVector();

        

        function onStartButton() {
            console.log("Start:");
            rawData = undefined;
            velocity = simplyVector();
            privAcl = simplyVector();
            path = simplyVector();
            startTime = acl.timestamp;
            rawData = []
        }

        function onEndButton() {
            var tmpData = rawData
            rawData = undefined
            startTime = undefined
            var myJSON = JSON.stringify(tmpData);
            rawDataDiv.innerHTML = myJSON;
            console.log(myJSON)
        }


        function onAccEvent() {

            if (rawData !== undefined && startTime !== undefined) 
            {
                let delta = (acl.timestamp - startTime) * 0.001;
                startTime = acl.timestamp;

                velocity.X = (privAcl.X + acl.x) / 2.0 * delta + velocity.X;
                velocity.Y = (privAcl.Y + acl.y) / 2.0 * delta + velocity.Y;
                velocity.Z = (privAcl.Z + acl.z) / 2.0 * delta + velocity.Z;
                privAcl.X = acl.x;
                privAcl.Y = acl.y;
                privAcl.Z = acl.z;

                var curPath = simplyVector()
                curPath.X = velocity.X * delta;
                curPath.Y = velocity.Y * delta;
                curPath.Z = velocity.Z * delta;

                path.X = path.X + curPath.X;
                path.Y = path.Y + curPath.Y;
                path.Z = path.Z + curPath.Z;

                var stat = {
                    eventNubmer: rawData.length,
                    acl: simpleVectorCPY(privAcl),
                    deltaT: delta,
                    velocity: simpleVectorCPY(velocity),
                    curPath: curPath,
                    totalPth: simpleVectorCPY(path)
                }
                //console.log(rawData.length)
                rawData.push(stat);
            }
        }

        Startbutton = document.getElementById('Startbutton');
        Stopbutton = document.getElementById('Stopbutton');
        Startbutton.onclick = onStartButton;
        Stopbutton.onclick = onEndButton;
        rawDataDiv = document.getElementById('rawData');
        acl.addEventListener('reading', onAccEvent);
        acl.addEventListener('activate', () => console.log('Ready to measure.'));
        acl.addEventListener('error', error => console.log(`Error: ${error.name}`));
        acl.start();

        rawDataDiv.innerHTML = "Ready to go"
    </script>
</body>